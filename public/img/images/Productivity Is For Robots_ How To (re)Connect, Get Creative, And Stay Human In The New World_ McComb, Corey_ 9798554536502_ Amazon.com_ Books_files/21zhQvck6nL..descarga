(function(e){var c=window.AmazonUIPageJS||window.P,f=c._namespace||c.attributeErrors,a=f?f("StarlingInterestGroupAssignment",""):c;a.guardFatal?a.guardFatal(e)(a,window):a.execute(function(){e(a,window)})})(function(e,c,f){e.register("StarlingIGJoinConfiguration",function(){return{getRoboticSessionId:function(){return"000-0000000-0000000"},getSecondsPerDay:function(){return 86400},getToken:function(a){switch(a){case "gamma":return"Ay3WBRr5OtmyD3mwpIWyox6nl2xsEL3JyighG4NpbfO3kyka10dzD97eJA+ekMnq3XLi8hPC8gpBGSClwt5wEgYAAACaeyJvcmlnaW4iOiJodHRwczovL2F0LWdhbW1hLXVzLWVhc3QuYW1hem9uLWFkc3lzdGVtLmNvbTo0NDMiLCJmZWF0dXJlIjoiUHJpdmFjeVNhbmRib3hBZHNBUElzIiwiZXhwaXJ5IjoxNjY5NzY2Mzk5LCJpc1N1YmRvbWFpbiI6dHJ1ZSwiaXNUaGlyZFBhcnR5Ijp0cnVlfQ\x3d\x3d";
case "prod":return"A7jDbyz2LmRMzv5b5laRj897GzAsLHZaNDTnlB+0XsNiHLfX8/4RcCUioP/IY9mxlewyosoNcmkbGyxc62ag1gcAAACEeyJvcmlnaW4iOiJodHRwczovL3d3dy5hbWF6b24uY29tOjQ0MyIsImZlYXR1cmUiOiJQcml2YWN5U2FuZGJveEFkc0FQSXMiLCJleHBpcnkiOjE2ODA2NTI3OTksImlzU3ViZG9tYWluIjp0cnVlLCJpc1RoaXJkUGFydHkiOnRydWV9"}},getUserAgent:function(){return navigator.userAgent}}});"use strict";e.register("StarlingAddMetric",function(){return{addMetric:function(a,b){c.ue&&c.ue.count&&c.ue.count(a,b)}}});"use strict";e.register("StarlingLogError",
function(){return{logError:function(a){var b={logLevel:2<arguments.length&&arguments[2]!==f?arguments[2]:"ERROR",attribution:"StarlingInterestGroupAssignment",message:1<arguments.length&&arguments[1]!==f?arguments[1]:""};c.ueLogError&&c.ueLogError(a,b);return[a,b]}}});"use strict";e.when("StarlingIGJoinConfiguration","StarlingAddMetric","StarlingLogError").register("StarlingIGJoinHelpers",function(a,b,d){function h(){return c.opts.customerId}function e(a){switch(a){case "beta":return"https://at-"+
a+".amazon-adsystem.com";case "gamma":return"https://at-"+a+"-us-east.amazon-adsystem.com";case "prod":return"https://at-us-east.amazon-adsystem.com"}}function q(a){if(a){if((a=a.interestGroups)&&Array.isArray(a)&&0<a.length)return b.addMetric("Starling:AttemptedIGAdd",a.length),a;b.addMetric("Starling:GatewayReturnedIGMetadata:False",1);a={message:"Starling:GatewayReturnedIGMetadata:False. IG Metadata from Gateway is empty or incorrect format."};d.logError(a);return null}b.addMetric("Starling:NullGatewayResponseError",
1);a={message:"Starling:NullGatewayResponseError. Null IGMetadata response from Gateway."};d.logError(a)}function n(a,b){return new Promise(function(g,d){try{navigator.joinAdInterestGroup(a,30*b),g()}catch(k){d(k)}})}function p(a,b){var g=[],d=!0,l=!1,c=f;try{for(var h=a[Symbol.iterator](),e;!(d=(e=h.next()).done);d=!0)g.push(n(e.value,b))}catch(v){l=!0,c=v}finally{try{!d&&h.return&&h.return()}finally{if(l)throw c;}}return g}function r(a,l){var g=0,c=0;a=p(a,l);Promise.allSettled(a).then(function(a){var d=
!0,l=!1,e=f;try{for(var k=a[Symbol.iterator](),m;!(d=(m=k.next()).done);d=!0)"fulfilled"===m.value.status?g+=1:c+=1}catch(w){l=!0,e=w}finally{try{!d&&k.return&&k.return()}finally{if(l)throw e;}}b.addMetric("Starling:BrowserAddedToIG:True",g);b.addMetric("Starling:BrowserAddedToIG:False",c);h()?b.addMetric("Starling:IGAssigned:AmazonCustomer",g):b.addMetric("Starling:IGAssigned:AmazonGuest",g)}).catch(function(a){b.addMetric("Starling:PromiseResolverError",1);d.logError(a,"Starling:PromiseResolveError. Error resolving IGJoinPromiseArray.")})}
function t(a){return c.localStorage.getItem(a)}function u(a,b){a=String(a);b=String(b);c.localStorage.setItem(a,b)}var x=/development|integ|beta|corp/,y=/pre-prod|preprod|gamma|master/,z=/prod/,A=/chrome|chromium|crios/i,B=/opr\//i,C=/edg/i;return{isChrome:function(){var b=a.getUserAgent(),d=!1;b&&(b.match(A)&&(d=!0),b.match(B)?d=!1:b.match(C)&&(d=!1));return d},browserSupportsAdInterestGroup:function(){return"joinAdInterestGroup"in navigator&&document.featurePolicy.allowsFeature("join-ad-interest-group")},
getWindowConfig:function(){return c.config},getWindowOpts:function(){return c.opts},getHref:function(){return c.location.href},getCustomerId:h,getApnPrivacySetting:function(){if(null!==document&&null!==document.cookie){var a=document.cookie.match(/(^| )apn-privacy=([^;]+)/);if(a)return"true"===a[2]}return!1},getSushiEndpoint:function(a){return JSON.parse(JSON.stringify(a))["Events.SushiEndpoint"]},getStage:function(a){if(x.test(a))return"beta";if(y.test(a))return"gamma";if(z.test(a))return"prod"},
generateGatewayUrl:e,provideToken:function(a){if(null!==document&&null!==document.head){var b=document.createElement("meta");b.httpEquiv="origin-trial";b.content=a;document.head.appendChild(b)}},parseIGMetadataFromResponse:q,createIGJoinPromise:n,createIGJoinPromiseArray:p,settleIGJoinPromises:r,joinAdInterestGroups:function(c,h){var g=a.getSecondsPerDay();h=e(h)+"/interestGroups/join/";var m=t("timestampForNextRequest"),k=m?Number(m):0;0==k||k<(new Date).getTime()?fetch(h,{method:"PUT",body:JSON.stringify(c)}).then(function(a){b.addMetric("Starling:ReceivedGatewayResponse",
1);return a.json()}).then(function(a){var b=JSON.parse(JSON.stringify(a));a=q(b);if(b=b.throttleTimeForNextRequest)k=0==b?0:Number(b)+(new Date).getTime(),u("timestampForNextRequest",k);a&&r(a,g)}).catch(function(a){b.addMetric("Starling:ParseGatewayResponseError",1);d.logError(a,"Starling:ParseGatewayResponseError. Error parsing IG Metadata from Gateway.")}):b.addMetric("Starling:ThrottledIGJoinRequests",1)},lookupLocalStorage:t,addToLocalStorage:u,removeFromLocalStorage:function(a){c.localStorage.getItem(a)!==
f&&c.localStorage.removeItem(a)}}});"use strict";e.register("StarlingInterestGroupAssign",function(){var a={init:function(b,d,c,e){a.config=b;a.helpers=e;a.metrics=d;a.errors=c;b=a.config.getRoboticSessionId();d=a.helpers.getWindowConfig();a.helpers.isChrome()&&(d?(d=a.helpers.getSushiEndpoint(d))?(d=a.helpers.getStage(d))?(c=a.config.getToken(d),a.helpers.provideToken(c),a.assignIG(d,b)):(a.metrics.addMetric("Starling:StageRetrievedError",1),b={message:"Starling:StageRetrievedError. Error getting stage."},
a.errors.logError(b)):a.metrics.addMetric("Starling:SushiEndpointRetrievedError",1):(a.metrics.addMetric("Starling:PageLoadError",1),b={message:"Starling:PageLoadError. Error getting window config."},a.errors.logError(b)))},assignIG:function(b,d){if(a.helpers.browserSupportsAdInterestGroup()){a.metrics.addMetric("Starling:BrowserSupportsAdInterestGroup:True",1);var c=a.helpers.getWindowOpts();if(c){var e=c.sessionId,f=c.pageType;c=c.asin;var n=a.helpers.getApnPrivacySetting(),p=a.helpers.getHref;
d=e===d;n||d?a.metrics.addMetric("Starling:TotalPunts",1):a.helpers.joinAdInterestGroups({identity:{sessionId:e},pageInformation:{pageURL:p,pageType:f,asins:[c]}},b);n&&a.metrics.addMetric("Starling:UserOptedOut:True",1);d&&a.metrics.addMetric("Starling:RoboticTraffic:True",1);a.helpers.getCustomerId()?a.metrics.addMetric("Starling:BrowserSupportsAdInterestGroup:AmazonCustomer",1):a.metrics.addMetric("Starling:BrowserSupportsAdInterestGroup:AmazonGuest",1)}else a.metrics.addMetric("Starling:OptsNotFoundError",
1),a.errors.logError({message:"Starling:OptsNotFoundError. Error getting windowOpts."})}else a.metrics.addMetric("Starling:BrowserSupportsAdInterestGroup:False",1)}};return a});e.when("StarlingIGJoinConfiguration","StarlingAddMetric","StarlingLogError","StarlingIGJoinHelpers","StarlingInterestGroupAssign","ready").execute(function(a,b,c,e,f){f.init(a,b,c,e)})});